<div class="app-container">
  <app-sidebar></app-sidebar>
  <div class="container-fluid mt-4">
    <div class="row">
      <!-- Bloc en haut à gauche : Informations de l'élève -->
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title">Informations de l'élève</h2>
            <div *ngIf="eleve">
              <p><strong>Nom :</strong> {{ eleve.nom }}</p>
              <p><strong>Prénom :</strong> {{ eleve.prenom }}</p>
              <p><strong>Date de naissance :</strong> {{ eleve.date_naissance | date:'dd/MM/yyyy' }}</p>
              <p><strong>Adresse :</strong> {{ eleve.adresse }}</p>
              <p><strong>Date d'inscription :</strong> {{ eleve.date_inscription | date:'dd/MM/yyyy' }}</p>
              <p><strong>NPEH :</strong> {{ eleve.npeh }}</p>
              <p><strong>Genre :</strong> {{ eleve.genre }}</p>
            </div>
          </div>
        </div>

        <!-- Bloc Avis modifié -->
        <div class="card">
          <div class="card-body">
            <h2 class="card-title">Avis de l'élève</h2>
            
            <div *ngIf="getPaginatedAvis().length > 0; else noAvis">
              <div *ngFor="let avis of getPaginatedAvis()" class="avis-item mb-3 p-3 border rounded">
                <p><strong>Commentaire :</strong> {{ avis.commentaire }}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    Posté le : {{ avis.date_commentaire | date:'dd/MM/yyyy HH:mm' }}
                  </small>
                  <select [(ngModel)]="avis.statut" (change)="updateAvisStatut(avis)" class="form-select form-select-sm w-auto">
                    <option value="Publié">Publié</option>
                    <option value="En attente">En attente</option>
                    <option value="Refusé">Refusé</option>
                  </select>
                </div>
              </div>

              <!-- Pagination -->
              <nav *ngIf="totalAvisPages > 1" class="mt-3">
                <ul class="pagination pagination-sm justify-content-center">
                  <li class="page-item" [class.disabled]="currentAvisPage === 1">
                    <a class="page-link" (click)="changeAvisPage(currentAvisPage - 1)">Précédent</a>
                  </li>
                  
                  <li *ngFor="let page of [].constructor(totalAvisPages); let i = index" 
                      class="page-item" [class.active]="currentAvisPage === i + 1">
                    <a class="page-link" (click)="changeAvisPage(i + 1)">{{ i + 1 }}</a>
                  </li>
                  
                  <li class="page-item" [class.disabled]="currentAvisPage === totalAvisPages">
                    <a class="page-link" (click)="changeAvisPage(currentAvisPage + 1)">Suivant</a>
                  </li>
                </ul>
              </nav>
            </div>

            <ng-template #noAvis>
              <p class="text-muted">Aucun avis posté par cet élève.</p>
            </ng-template>
          </div>
        </div>
      </div>
<!-- Bloc à droite : Gestion des scores -->
<div class="col-md-8">
  <div class="card">
    <div class="card-body">
      <h2 class="card-title">Scores de l'élève</h2>
      <button class="btn btn-primary mb-3" (click)="openAddScoreForm()">Ajouter un score</button>
      <table class="table table-striped">
        <thead class="bg-primary text-white">
          <tr>
            <th>Thème</th>
            <th>Date du test</th>
            <th>Score</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let score of getPaginatedScores()">
            <td>{{ score.theme }}</td>
            <td>{{ score.date_test | date:'dd/MM/yyyy' }}</td>
            <td>{{ score.score }}</td>
            <td>
              <button class="btn btn-primary btn-sm mr-2" (click)="openEditScoreForm(score)">Modifier</button>
              <button class="btn btn-danger btn-sm" (click)="onDeleteScore(score)">Supprimer</button>
            </td>
          </tr>
          <tr *ngIf="scores.length === 0">
            <td colspan="4" class="text-center">Aucun score enregistré pour cet élève</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination Scores -->
      <nav *ngIf="totalScorePages > 1" class="mt-3">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentScorePage === 1">
            <a class="page-link" (click)="changeScorePage(currentScorePage - 1)">Précédent</a>
          </li>
          
          <li *ngFor="let page of [].constructor(totalScorePages); let i = index" 
              class="page-item" [class.active]="currentScorePage === i + 1">
            <a class="page-link" (click)="changeScorePage(i + 1)">{{ i + 1 }}</a>
          </li>
          
          <li class="page-item" [class.disabled]="currentScorePage === totalScorePages">
            <a class="page-link" (click)="changeScorePage(currentScorePage + 1)">Suivant</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

  <!-- Modales pour les scores (inchangées) -->
  <div *ngIf="showAddScoreForm" class="modal-backdrop" (click)="closeAddScoreForm()"></div>
  <div *ngIf="showAddScoreForm" class="modal-content">
    <div class="card">
      <div class="card-body">
        <h3>Ajouter un nouveau score</h3>
        <form (ngSubmit)="addScore()">
          <div class="form-group">
            <label for="theme">Thème</label>
            <input type="text" class="form-control" id="theme" [(ngModel)]="newScore.theme" name="theme" required>
          </div>
          <div class="form-group">
            <label for="date_test">Date du test</label>
            <input type="date" class="form-control" id="date_test" [(ngModel)]="newScore.date_test" name="date_test" required>
          </div>
          <div class="form-group">
            <label for="score">Score</label>
            <input type="number" class="form-control" id="score" [(ngModel)]="newScore.score" name="score" min="0" max="100" required>
          </div>
          <button type="submit" class="btn btn-success">Ajouter</button>
          <button type="button" class="btn btn-secondary ml-2" (click)="closeAddScoreForm()">Annuler</button>
        </form>
      </div>
    </div>
  </div>

  <div *ngIf="showEditScoreForm" class="modal-backdrop" (click)="closeEditScoreForm()"></div>
  <div *ngIf="showEditScoreForm" class="modal-content">
    <div class="card">
      <div class="card-body">
        <h3>Modifier le score</h3>
        <form (ngSubmit)="updateScore()">
          <div class="form-group">
            <label for="edit-theme">Thème</label>
            <input type="text" class="form-control" id="edit-theme" [(ngModel)]="editScoreData.theme" name="edit-theme" required>
          </div>
          <div class="form-group">
            <label for="edit-date_test">Date du test</label>
            <input type="date" class="form-control" id="edit-date_test" [(ngModel)]="editScoreData.date_test" name="edit-date_test" required>
          </div>
          <div class="form-group">
            <label for="edit-score">Score</label>
            <input type="number" class="form-control" id="edit-score" [(ngModel)]="editScoreData.score" name="edit-score" min="0" max="100" required>
          </div>
          <button type="submit" class="btn btn-warning">Mettre à jour</button>
          <button type="button" class="btn btn-secondary ml-2" (click)="closeEditScoreForm()">Annuler</button>
        </form>
      </div>
    </div>
  </div>
</div>